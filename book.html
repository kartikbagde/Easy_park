<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ParkSmart — Student Parking Slots</title>
  <link rel="stylesheet" href="/style/addmember.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  </head>
  <body>

    <header> ParkSmart — Student Parking Slots</header>


    <div class="main-container">
      <div class="map-container">
        <div id="map"></div>
      </div>

      
      <div class="slots-container">
        <div id="controls">
          <button id="minAllBtn" onclick="minimizeAll()">Minimize All</button>
          <button id="maxAllBtn" onclick="maximizeAll()">Maximize All</button>
        </div>
        <div id="slots"></div>
        <button id="bookBtn" onclick="bookSelectedSlot()" disabled>Book Selected Slot</button>
      </div>
    </div>

      <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
        <script>

          const studentParkingCoords = [
            [21.1232, 79.0030],
            [21.1232, 79.0040],
            [21.1240, 79.0040],
            [21.1240, 79.0030]
          ];

          const map = L.map('map').setView([21.1236, 79.0035], 19);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution:'© OpenStreetMap contributors' }).addTo(map);
          L.polygon(studentParkingCoords, {color:'#00b300', weight:2, fillOpacity:0.05}).addTo(map);


          const markers = [];
          const slotData = [];
          const rows = 16;
          const cols = 20;
          const latStart = studentParkingCoords[0][0];
          const latEnd = studentParkingCoords[2][0];
          const lonStart = studentParkingCoords[0][1];
          const lonEnd = studentParkingCoords[2][1];

          for(let i=0;i<rows;i++){
            for(let j=0;j<cols;j++){
              const lat = latStart + i*(latEnd-latStart)/rows;
              const lon = lonStart + j*(lonEnd-lonStart)/cols;
              const slotId = `R${i+1}C${j+1}`;
              const marker = L.circleMarker([lat, lon], {radius:3, color:'#ff0000', fillOpacity:1}).addTo(map);
              marker.bindPopup(`<b>Parking Slot</b><br>${slotId}<br><button class="popup-btn" onclick="bookMarkerSlot('${slotId}')">Book This Spot</button>`);
              markers.push(marker);
              slotData.push({id: slotId, marker: marker, booked:false});
            }
          }


          function showSlots(){
            const slotsDiv = document.getElementById('slots');
            slotsDiv.innerHTML = "<div class='slot-grid'>";
            slotData.forEach(slot=>{
              slotsDiv.innerHTML += `
                <div class='slot' id='${slot.id}' onclick="selectSlot(this)">
                  <div class='slot-header'>
                    ${slot.id} <button class='toggle-btn' onclick="toggleSlot(event,this)">➕</button>
                  </div>
                  <div class='slot-details'>
                    <p>Size: Standard</p>
                    <p>Near Entrance: Yes</p>
                    <p>Status: Available</p>
                  </div>
                </div>`;
            });
            slotsDiv.innerHTML += "</div>";
          }
          showSlots();

          let selectedSlot = null;
          function selectSlot(element){
            document.querySelectorAll(".slot").forEach(s=>s.classList.remove("selected"));
            element.classList.add("selected");
            selectedSlot = element.id;
            document.getElementById("bookBtn").disabled = false;

            const slot = slotData.find(s=>s.id===selectedSlot);
            if(slot) map.panTo(slot.marker.getLatLng());
          }

          function toggleSlot(event,btn){
            event.stopPropagation();
            const details = btn.parentElement.nextElementSibling;
            if(details.style.display==="block"){ details.style.display="none"; btn.textContent="➕"; }
            else{ details.style.display="block"; btn.textContent="➖"; }
          }

          function minimizeAll(){ document.querySelectorAll(".slot-details").forEach(d=>d.style.display="none"); document.querySelectorAll(".toggle-btn").forEach(b=>b.textContent="➕"); }
          function maximizeAll(){ document.querySelectorAll(".slot-details").forEach(d=>d.style.display="block"); document.querySelectorAll(".toggle-btn").forEach(b=>b.textContent="➖"); }

          function bookSelectedSlot(){
            if(selectedSlot){
              const slot = slotData.find(s=>s.id===selectedSlot);
              if(slot.booked){ alert(`${selectedSlot} is already booked!`); return; }
              slot.booked = true;
              alert(`✅ You have successfully booked ${selectedSlot}`);
              document.getElementById(selectedSlot).querySelector(".slot-details p:last-child").innerText="Status: Booked";
              slot.marker.setStyle({color:'#00b300'});
            }
          }

          function bookMarkerSlot(slotId){
            const slot = slotData.find(s=>s.id===slotId);
            if(slot.booked){ alert(`${slotId} is already booked!`); return; }
            slot.booked = true;
            alert(`✅ You have successfully booked ${slotId}`);
            slot.marker.setStyle({color:'#00b300'});
            const slotDiv = document.getElementById(slotId);
            slotDiv.querySelector(".slot-details p:last-child").innerText="Status: Booked";
            selectSlot(slotDiv);
          }

          markers.forEach((marker,i)=>{
            marker.on('click',()=>{
              const slotDiv = document.getElementById(slotData[i].id);
              if(slotDiv) selectSlot(slotDiv);
            });
          });
        </script>

    </body>
</html>
